<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>⚽ Football KPD Predictor | Powered by denflpv</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Football KPD Predictor</h1>
            <p>Анализ эффективности футболистов на основе ключевых статистических показателей</p>
        </div>

        <div class="card">
            <div class="tabs">
                <div class="tab active" onclick="showTab('single')">Один игрок</div>
                <div class="tab" onclick="showTab('batch')">Несколько игроков</div>
            </div>

            <!-- Форма для одного игрока -->
            <div id="single-tab" class="tab-content active">
                <form id="prediction-form">
                    <div class="form-group">
                        <label for="goals">Голы:</label>
                        <input type="number" id="goals" name="goals" step="1" placeholder="Введите количество голов" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="shots">Удары:</label>
                        <input type="number" id="shots" name="shots" step="1" placeholder="Введите количество ударов" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="xGoals">xG (Ожидаемые голы):</label>
                        <input type="number" id="xGoals" name="xGoals" step="0.01" placeholder="Введите xG" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="assists">Голевые передачи:</label>
                        <input type="number" id="assists" name="assists" step="1" placeholder="Введите голевые передачи" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="keyPasses">Ключевые передачи:</label>
                        <input type="number" id="keyPasses" name="keyPasses" step="1" placeholder="Введите ключевые передачи" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="time">Сыгранные минуты:</label>
                        <input type="number" id="time" name="time" value="90" placeholder="Введите минуты" required>
                    </div>
                    
                    <button type="submit" class="btn">Рассчитать КПД</button>
                </form>
            </div>

            <!-- Форма для нескольких игроков -->
            <div id="batch-tab" class="tab-content">
                <h3>Загрузка CSV файла</h3>
                <p>Файл должен содержать колонки: goals, shots, xGoals, assists, keyPasses, time</p>
                
                <form id="batch-form" enctype="multipart/form-data">
                    <div class="form-group file-input">
                        <label for="csv-file">Выберите CSV файл</label>
                        <input type="file" id="csv-file" name="file" accept=".csv" required>
                    </div>
                    
                    <button type="submit" class="btn">Рассчитать КПД для всех</button>
                </form>
                
                <div id="batch-result" class="batch-result" style="display: none;">
                    <h3>Результаты обработки</h3>
                    <p id="batch-message"></p>
                    <a id="download-link" href="#" class="download-link">Скачать результаты CSV</a>
                </div>
            </div>

            <div id="result" class="result" style="display: none;">
                <h3>Результат предсказания:</h3>
                <div class="kpd-value" id="kpd-value">0%</div>
                <p>На основе введенных статистических данных</p>
            </div>

            <div id="error" class="error" style="display: none;"></div>
        </div>
        

    <script>
        function showTab(tabName) {
            // Скрыть все табы
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Показать выбранный таб
            document.getElementById(tabName + '-tab').classList.add('active');
            event.currentTarget.classList.add('active');
        }

        // Обработка формы одного игрока
        document.getElementById('prediction-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = Object.fromEntries(formData.entries());
            const btn = this.querySelector('.btn');
            
            // Показать состояние загрузки
            btn.classList.add('loading');
            btn.textContent = 'Загрузка...';
            
            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('kpd-value').textContent = result.kpd + '%';
                    document.getElementById('result').style.display = 'block';
                    document.getElementById('error').style.display = 'none';
                    
                    // Анимация появления результата
                    document.getElementById('result').style.animation = 'fadeIn 0.6s ease';
                } else {
                    showError(result.error);
                }
            } catch (error) {
                showError('Ошибка соединения с сервером');
            } finally {
                // Убрать состояние загрузки
                btn.classList.remove('loading');
                btn.textContent = 'Рассчитать КПД';
            }
        });

        // Обработка формы нескольких игроков
        document.getElementById('batch-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const btn = this.querySelector('.btn');
            
            // Показать состояние загрузки
            btn.classList.add('loading');
            btn.textContent = 'Обработка...';
            
            try {
                const response = await fetch('/batch_predict', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('batch-message').textContent = result.message;
                    document.getElementById('download-link').href = result.download_link;
                    document.getElementById('batch-result').style.display = 'block';
                    document.getElementById('batch-result').style.animation = 'slideIn 0.5s ease';
                } else {
                    showError(result.error);
                }
            } catch (error) {
                showError('Ошибка соединения с сервером');
            } finally {
                // Убрать состояние загрузки
                btn.classList.remove('loading');
                btn.textContent = 'Рассчитать КПД для всех';
            }
        });

        // Обработка выбора файла
        document.getElementById('csv-file').addEventListener('change', function(e) {
            const label = this.previousElementSibling;
            if (this.files.length > 0) {
                label.textContent = 'Файл выбран: ' + this.files[0].name;
                label.style.background = 'var(--success)';
                label.style.color = 'white';
            } else {
                label.textContent = 'Выберите CSV файл';
                label.style.background = 'var(--background)';
                label.style.color = 'var(--text-primary)';
            }
        });

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            errorDiv.style.animation = 'shake 0.5s ease';
            document.getElementById('result').style.display = 'none';
            
            // Автоматически скрыть ошибку через 5 секунд
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        // Анимация появления элементов при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelector('.header').style.animation = 'fadeIn 1s ease';
            document.querySelector('.card').style.animation = 'slideUp 0.8s ease';
        });
    </script>
    <script src="{{ url_for('static', filename='particles.js') }}"></script>
</body>
</html>